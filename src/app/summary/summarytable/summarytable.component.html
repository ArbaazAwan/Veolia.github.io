
<button type="button" class="btn bg-gradient-primary text-right" 
*ngIf="showButton" (click)="toggleModal()" >
  View More Info
</button>
<button data-bs-toggle="modal" data-bs-target="#detail-table" #hiddenFormBtn  hidden>hidden</button>
<div class="row mx-1">
  <div class="col-12">
    <div class="card my-1">
      <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
        <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
          <p class="text-white text-capitalize text-bold ps-3">Summary Table</p>
        </div>
      </div>
      <div class="d-flex justify-content-center my-6" *ngIf="isLoading">
        <div class="spinner-border"></div>
      </div>
      
      <!-- Summary table -->
      <div class="card-body px-0 " *ngIf="!isLoading">
        <div class="flex-end px-3 col-md-3 mt-3" *ngIf="!isLoading">
          <mat-form-field class="example-form-field" appearance="outline" class="text-xs">
            <mat-label>Search Assets</mat-label>
            <input matInput type="text" [(ngModel)]="searchText" (ngModelChange)="onSearch($event)" />
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
        </div>
        <div class="p-0 table-responsive custom-table" *ngIf="!isLoading">
          <p-table [value]="filteredSummaries" dataKey="summaryId" sortField="summaryId" [sortOrder]="-1" editMode="row" scrollHeight="600px">
            <ng-template pTemplate="header">
              <tr style="z-index: 50rem;">
                <th  style="min-width: 170px;" class="text-uppercase text-bold text-xs font-weight-bolder" *ngIf="siteStatus">
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actions
                </th>
                <th style="min-width: 100px;" pSortableColumn="summaryId" class="text-uppercase text-bold text-xs font-weight-bolder">
                  &nbsp;ID <p-sortIcon field="summaryId"></p-sortIcon>
                </th>
                <th pSortableColumn="eqpFunctionalDesc" class="text-uppercase text-bold text-xs font-weight-bolder" style="font-size: small; min-width: 350px;">
                  Asset Description <p-sortIcon field="eqpFunctionalDesc"></p-sortIcon>
                </th>
                <th pSortableColumn="assetId"  class="text-uppercase text-bold text-xs font-weight-bolder" style="font-size: small; min-width: 150px;">
                  Asset Id <p-sortIcon field="assetId"></p-sortIcon>
                </th>
                <th pSortableColumn="importAssetType"  class="text-uppercase text-bold text-xs font-weight-bolder" style="font-size: small; min-width: 250px;">
                  Asset Type <p-sortIcon field="importAssetType"></p-sortIcon>
                </th>
                <th pSortableColumn="assetHierarchy" class="text-uppercase text-bold text-xs font-weight-bolder" style="font-size: small; min-width: 250px;">
                  Asset Hierarchy <p-sortIcon field="assetHierarchy"></p-sortIcon>
                </th>
                <th  style="min-width: 150px;" pSortableColumn="assetType" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Master Template Asset Type <p-sortIcon field="assetType"></p-sortIcon>
                </th>
                <th style="min-width: 150px;" pSortableColumn="summaryStyle" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Style <p-sortIcon field="summaryStyle"></p-sortIcon>
                </th>
                <th style="min-width: 150px;" pSortableColumn="summarySize" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Size <p-sortIcon field="summarySize"></p-sortIcon>
                </th>
                <th style="min-width: 150px;" pSortableColumn="dutyApplication" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Duty or Application <p-sortIcon field="dutyApplication"></p-sortIcon>
                </th>
                <th style="min-width: 130px;" pSortableColumn="quality" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Quality <p-sortIcon field="quality"></p-sortIcon>
                </th>
                <th style="min-width: 130px;" pSortableColumn="quantity" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Quantity <p-sortIcon field="quantity"></p-sortIcon>
                </th>
                <th style="min-width: 130px;" pSortableColumn="summaryload" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Load % <p-sortIcon field="summaryload"></p-sortIcon>
                </th>
                <th style="min-width: 200px;" pSortableColumn="installmentDate" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Installation Date <p-sortIcon field="installmentDate"></p-sortIcon>
                </th>
                <th style="min-width: 120px;" pSortableColumn="life" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Life % <p-sortIcon field="life"></p-sortIcon>
                </th>
                <th style="min-width: 100px;" pSortableColumn="remainingLife" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Remaining Life % <p-sortIcon field="remainingLife"></p-sortIcon>
                </th>
                <th style="min-width: 250px;" class="text-uppercase text-bold text-xs font-weight-bolder ">
                  Unit Template Descripton
                </th>
                <th style="min-width: 250px;" class="text-uppercase text-bold text-xs font-weight-bolder">
                  unit template application
                </th>
                <th style="min-width: 150px;" pSortableColumn="dateCreated" class="text-uppercase text-bold text-xs font-weight-bolder">
                  Created Date <p-sortIcon field="dateCreated"></p-sortIcon>
                </th>
                <th style="min-width: 150px;" pSortableColumn="masterId" class="text-uppercase text-bold text-xs font-weight-bolder">
                  &nbsp;Master Id <p-sortIcon field="masterId"></p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-editing="editing" let-summary let-ri="rowIndex">
              <tr [pEditableRow]="summary" >
                <td *ngIf="siteStatus" style="min-width: 180px;" >
                  <button *ngIf="!editing" pButton pRipple type="button" pInitEditableRow icon="pi pi-pencil"
                    (click)="onRowEditInit(summary)" title="Edit" class="p-button-rounded p-button-text">
                  </button>
                  <button *ngIf="!editing" pButton title="Duplicate" pRipple type="button" icon="pi pi-clone"
                    (click)="onRowDuplicate(summary.summaryId)" class="p-button-rounded p-button-text p-button-warning">
                  </button>
                  <button *ngIf="!editing" pButton title="Delete" pRipple type="button" pSaveEditableRow
                    icon="pi pi-trash" (click)="onRowDelete(summary)"
                    class="p-button-rounded p-button-text p-button-danger p-mr-2">
                  </button>
                  <button *ngIf="editing" pButton title="Save" pRipple type="button" pSaveEditableRow icon="pi pi-check"
                    (click)="onRowEditSave(summary)" [disabled]="!dateValid"
                    class="p-button-rounded p-button-text p-button-success p-mr-2">
                  </button>
                  <button *ngIf="editing" pButton title="Cancel" pRipple type="button" pCancelEditableRow
                    icon="pi pi-times" (click)="onRowEditCancel(summary, ri)"
                    class="p-button-rounded p-button-text p-button-danger">
                  </button>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" style="min-width: 70px;" disabled [(ngModel)]="summary.summaryId">
                    </ng-template>
                    <ng-template pTemplate="output" style="min-width: 70px;" class="mb-0 text-sm">
                      {{summary.summaryId}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td style="font-family: Roboto;">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="min-width: 300px; font-family: Roboto;" pInputText type="text" placeholder="Enter Asset Description" [(ngModel)]="summary.eqpFunctionalDesc">
                    </ng-template>
                    <ng-template pTemplate="output" style="font-family: Roboto;">
                      {{summary.eqpFunctionalDesc}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="width: 110px;" pInputText type="text" placeholder="Enter Asset ID" [(ngModel)]="summary.assetId">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.assetId}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="min-width: 150px;" pInputText type="text" placeholder="Enter Asset Type" [(ngModel)]="summary.importAssetType">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.importAssetType}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="min-width: 200px;" pInputText type="text" placeholder="Enter Asset Hierarchy" [(ngModel)]="summary.assetHierarchy">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.assetHierarchy}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td *ngIf="editing">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <p-dropdown appendTo="body" [options]="masters" (onChange)="onAssetChange($event.value,summary)"
                         optionLabel="oldAssetType" [filter]="true"
                        filterBy="oldAssetType,newAssetType,masterStyle,masterSize,dutyApplication,quality"
                        placeholder="Search Master Template">
                        <ng-template pTemplate="selectedMaster">
                          <div *ngIf="selectedMaster">
                            <div>
                              {{selectedMaster.oldAssetType}} - {{ selectedMaster.newAssetType }},
                              {{selectedMaster.masterStyle}}, {{selectedMaster.masterSize}},
                              {{selectedMaster.dutyApplication}}, {{selectedMaster.quality}}
                            </div>
                          </div>
                        </ng-template>
                        <ng-template let-master pTemplate="master">
                          <div>
                            <div>
                              {{master.oldAssetType}} - {{ master.newAssetType }},
                              {{master.masterStyle}}, {{master.masterSize}},
                              {{master.dutyApplication}}, {{master.quality}}
                            </div>
                          </div>
                        </ng-template>
                      </p-dropdown>
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td *ngIf="!editing">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" placeholder=" Enter Master Template Asset Type" [(ngModel)]="summary.assetType">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.assetType}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" placeholder="Enter Style" [(ngModel)]="summary.summaryStyle">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.summaryStyle}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" placeholder="Enter Size" [(ngModel)]="summary.summarySize">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.summarySize}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" placeholder="Enter Duty / Application" [(ngModel)]="summary.dutyApplication">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.dutyApplication}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" placeholder="Enter Quality" [(ngModel)]="summary.quality">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.quality}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="width: 100px;" pInputText type="text" placeholder="Enter Quantity" [(ngModel)]="summary.quantity">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.quantity}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="width: 100px;" pInputText type="text" placeholder="Enter Load %" [(ngModel)]="summary.summaryload">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.summaryload}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <p-calendar appendTo="body" [(ngModel)]="summary.installmentDate" [showIcon]="true" inputId="icon"
                      (onSelect)="onInstallmentChange(summary)"></p-calendar>
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.installmentDate | date}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="width: 100px;" placeholder="Enter Life %" pInputText type="text" [(ngModel)]="summary.life">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.life}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input style="width: 100px;" placeholder="Enter Remaining Life" pInputText type="text" [(ngModel)]="100-summary.life">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{100 - summary.life}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input disabled pInputText type="text" [(ngModel)]="summary.assetType + ' - ' + summary.summaryStyle + ', ' +
                      summary.summarySize + ', ' + summary.dutyApplication + ', ' +
                      summary.quality">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.assetType + ' - ' + summary.summaryStyle + ', ' +
                      summary.summarySize + ', ' + summary.dutyApplication + ', ' +
                      summary.quality }}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" placeholder="Enter Unit Template Application" [(ngModel)]="summary.appDescription">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.appDescription}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText disabled type="text" [(ngModel)]="summary.dateCreated">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{summary.dateCreated | date}}
                    </ng-template>
                  </p-cellEditor>
                </td>
                <td>
                  <p-cellEditor>
                    <ng-template pTemplate="input" >
                      <input pInputText type="text" disabled [(ngModel)]="summary.masterId">
                    </ng-template>
                    <ng-template pTemplate="output" class="mb-0 text-sm">
                      {{summary.masterId}}
                    </ng-template>
                  </p-cellEditor>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- asset detail table modal -->

<div class="modal fade" id="detail-table" tabindex="-1" role="dialog" aria-labelledby="detail-table" aria-hidden="true">
  <app-summary-viewdetails-table (closeModal)="toggleModal()" *ngIf="summaries.length!=0 && showForm" [summaryArray]="summaries" ></app-summary-viewdetails-table>
</div>
